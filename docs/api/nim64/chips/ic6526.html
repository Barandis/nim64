<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>nim64/chips/ic6526</title>
<link rel="stylesheet" type="text/css" href="../../nimdoc.out.css">

<script type="text/javascript" src="../../dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);

  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true;
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">nim64/chips/ic6526</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    <li>
      <a href="../../theindex.html">Index</a>
    </li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<ul class="simple"><li><a class="reference" id="parallel-data-ports_toc" href="#parallel-data-ports">Parallel Data Ports</a></li>
<li><a class="reference" id="interval-timers_toc" href="#interval-timers">Interval Timers</a></li>
<li><a class="reference" id="time-of-day-clock_toc" href="#time-of-day-clock">Time of Day Clock</a></li>
<li><a class="reference" id="serial-data-port_toc" href="#serial-data-port">Serial Data Port</a></li>
<li><a class="reference" id="control-registers_toc" href="#control-registers">Control Registers</a></li>
<ul class="simple"><li><a class="reference" id="control-registers-interrupt-control-register-icr_toc" href="#control-registers-interrupt-control-register-icr">Interrupt Control Register (<tt class="docutils literal"><span class="pre">ICR</span></tt>)</a></li>
<li><a class="reference" id="control-registers-control-register-a-cra_toc" href="#control-registers-control-register-a-cra">Control Register A (<tt class="docutils literal"><span class="pre">CRA</span></tt>)</a></li>
<li><a class="reference" id="control-registers-control-register-b-crb_toc" href="#control-registers-control-register-b-crb">Control Register B (<tt class="docutils literal"><span class="pre">CRB</span></tt>)</a></li>
</ul><li><a class="reference" id="pin-interface_toc" href="#pin-interface">Pin Interface</a></li>
</ul><li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#Ic6526"
    title="Ic6526 = ref object
  pins: Pins
  registers: Registers">Ic6526</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">registers
      <li><a class="reference" href="#registers%2CIc6526"
    title="registers(chip`gensym1: Ic6526): seq[RegisterInfo]">registers,<wbr>Ic6526</a></li>

  </ul>
  <ul class="simple nested-toc-section">newIc6526
      <li><a class="reference" href="#newIc6526"
    title="newIc6526(): Ic6526">newIc6526</a></li>

  </ul>
  <ul class="simple nested-toc-section">pins
      <li><a class="reference" href="#pins%2CIc6526"
    title="pins(chip`gensym0: Ic6526): seq[PinInfo]">pins,<wbr>Ic6526</a></li>

  </ul>
  <ul class="simple nested-toc-section">[]
      <li><a class="reference" href="#%5B%5D%2CIc6526%2Cint"
    title="`[]`(chip`gensym0: Ic6526; index`gensym0: int): Pin">[],<wbr>Ic6526,<wbr>int</a></li>
  <li><a class="reference" href="#%5B%5D%2CIc6526%2Cstring"
    title="`[]`(chip`gensym0: Ic6526; index`gensym0: string): Pin">[],<wbr>Ic6526,<wbr>string</a></li>

  </ul>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#15" id="65">Iterators</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#items.i%2CIc6526"
    title="items(chip`gensym0: Ic6526): Pin">items</a></li>
  <li><a class="reference" href="#pairs.i%2CIc6526"
    title="pairs(chip`gensym0: Ic6526): (int, Pin)">pairs</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#19" id="69">Exports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>An emulation of the 6526 Complex Interface Adapter.</p>
<p>The 6526 CIA was designed as an I/O provider for the 6500-series microprocessors. It features two 8-bit parallel data ports, a serial data port, two microsecond-accuracy interval timers, and a 0.1 second-accuracy time-of-day clock.</p>
<p>These features are controlled and interacted with via 16 8-bit registers on the chip. In the Commodore 64, these can be accessed with the base addresses of <tt class="docutils literal"><span class="pre">$DC00</span></tt> (for CIA 1) and <tt class="docutils literal"><span class="pre">$DD00</span></tt> (for CIA 2).</p>
<table border="1" class="docutils"><tr><th>Offset</th><th>Register</th><th>Function</th></tr>
<tr><td><tt class="docutils literal"><span class="pre">$0</span></tt></td><td><tt class="docutils literal"><span class="pre">PRA</span></tt></td><td>Parallel Data Register A</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$1</span></tt></td><td><tt class="docutils literal"><span class="pre">PRB</span></tt></td><td>Parallel Data Register B</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$2</span></tt></td><td><tt class="docutils literal"><span class="pre">DDRA</span></tt></td><td>Data Direction Register A</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$3</span></tt></td><td><tt class="docutils literal"><span class="pre">DDRB</span></tt></td><td>Data Direction Register B</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$4</span></tt></td><td><tt class="docutils literal"><span class="pre">TALO</span></tt></td><td>Timer A Low Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$5</span></tt></td><td><tt class="docutils literal"><span class="pre">TAHI</span></tt></td><td>Timer A High Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$6</span></tt></td><td><tt class="docutils literal"><span class="pre">TBLO</span></tt></td><td>Timer B Low Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$7</span></tt></td><td><tt class="docutils literal"><span class="pre">TBHI</span></tt></td><td>Timer B High Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$8</span></tt></td><td><tt class="docutils literal"><span class="pre">TOD10TH</span></tt></td><td>Time-of-Day Tenths Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$9</span></tt></td><td><tt class="docutils literal"><span class="pre">TODSEC</span></tt></td><td>Time-of-Day Seconds Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$A</span></tt></td><td><tt class="docutils literal"><span class="pre">TODMIN</span></tt></td><td>Time-of-Day Minutes Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$B</span></tt></td><td><tt class="docutils literal"><span class="pre">TODHR</span></tt></td><td>Time-of-Day Hours Regsiter</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$C</span></tt></td><td><tt class="docutils literal"><span class="pre">SDR</span></tt></td><td>Serial Data Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$D</span></tt></td><td><tt class="docutils literal"><span class="pre">ICR</span></tt></td><td>Interrupt Control Register</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$E</span></tt></td><td><tt class="docutils literal"><span class="pre">CRA</span></tt></td><td>Control Register A</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">$F</span></tt></td><td><tt class="docutils literal"><span class="pre">CRB</span></tt></td><td>Control Register B</td></tr>
</table>
<h2><a class="toc-backref" id="parallel-data-ports" href="#parallel-data-ports">Parallel Data Ports</a></h2><p>The pins <tt class="docutils literal"><span class="pre">PA0</span></tt>-<tt class="docutils literal"><span class="pre">PA7</span></tt> and <tt class="docutils literal"><span class="pre">PB0</span></tt>-<tt class="docutils literal"><span class="pre">PB7</span></tt> make up the two parallel data ports. The direction of each pin (input or output) is controlled individually by the corresponding bit in the Data Direction Register for each port (<tt class="docutils literal"><span class="pre">DDRA</span></tt> and <tt class="docutils literal"><span class="pre">DDRB</span></tt> respectively). Setting a bit to <tt class="docutils literal"><span class="pre">1</span></tt> means that that pin is being used as an output; a <tt class="docutils literal"><span class="pre">0</span></tt> sets it to an input instead.</p>
<p>The parallel data registers, when read, return the state of the port's pins at that time, whether the pin is an input or an output. Writing to the parallel data registers sets the value of a pin (as long as it's an output pin, bits associated with input pins are ignored).</p>
<p>Port B additionally can be used as outputs for the timers; <tt class="docutils literal"><span class="pre">PB6</span></tt> can signal for Timer A and <tt class="docutils literal"><span class="pre">PB7</span></tt> for Timer B. To do this, the <tt class="docutils literal"><span class="pre">PBON</span></tt> bit in the appropriate control register (<tt class="docutils literal"><span class="pre">CRA</span></tt> or <tt class="docutils literal"><span class="pre">CRB</span></tt>) must be set. The output mode is set with the <tt class="docutils literal"><span class="pre">OUTMODE</span></tt> bit in the same register. Setting this bit means that the output pin will toggle levels each time the timer reaches 0; clearing it means that a one-cycle-long high pulse will happen each time the timer reaches 0. This setting overrides the input/output settings; as long as one of the <tt class="docutils literal"><span class="pre">PBON</span></tt> bits is set, that Port B pin will be an output whatever is set in <tt class="docutils literal"><span class="pre">DDRB</span></tt>.</p>
<p>Finally, the <tt class="docutils literal"><span class="pre">PC</span></tt> pin is associated with Port B. Each time <tt class="docutils literal"><span class="pre">PRB</span></tt> is read or written, the <tt class="docutils literal"><span class="pre">PC</span></tt> pin will go low for one cycle. This is useful as a signal that either the port's data has been accepted or that the port has data ready to be received.</p>

<h2><a class="toc-backref" id="interval-timers" href="#interval-timers">Interval Timers</a></h2><p>The two interval timers each track their countdown in pairs of registers - <tt class="docutils literal"><span class="pre">TALO</span></tt> and <tt class="docutils literal"><span class="pre">TAHI</span></tt> for Timer A and <tt class="docutils literal"><span class="pre">TBLO</span></tt> and <tt class="docutils literal"><span class="pre">TBHI</span></tt> for Timer B - allowing them to count a maximum of 65,536 cycles. The timers can count clock cycles (provided on pin <tt class="docutils literal"><span class="pre">PHI2</span></tt>) or transitions of the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin to high. Given clock cycles with a 1 MHz clock frequency (typical of a Commodore 64), this makes for a maximum interval of about 0.066 seconds.</p>
<p>Timer B can additionally count the number of times that Timer A reaches zero (called &quot;underflow&quot; in the literature) or the number of times that Timer A reaches zero while the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin is high. By setting Timer A to count clock cycles and Timer B to count Timer A underflows, a maximum interval of over 71 minutes can be achieved.</p>
<p>The type of event to count is set in the control registers. <tt class="docutils literal"><span class="pre">CRA</span></tt> has a bit called <tt class="docutils literal"><span class="pre">INMODE</span></tt>; if this is <tt class="docutils literal"><span class="pre">0</span></tt>, Timer A counts clock cycles, and if it's <tt class="docutils literal"><span class="pre">1</span></tt>, Timer A counts <tt class="docutils literal"><span class="pre">CNT</span></tt> transitions. For Timer B, <tt class="docutils literal"><span class="pre">CRB</span></tt> has <em>two</em> bits (<tt class="docutils literal"><span class="pre">INMODE0</span></tt> and <tt class="docutils literal"><span class="pre">INMODE1</span></tt>). A value of <tt class="docutils literal"><span class="pre">00</span></tt> or <tt class="docutils literal"><span class="pre">01</span></tt> on these bits is the same as for Timer A, but <tt class="docutils literal"><span class="pre">10</span></tt> causes Timer B to count Timer A underflows and <tt class="docutils literal"><span class="pre">11</span></tt> means Timer B will count only the Timer A underflows that happen when the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin is high.</p>
<p>Once a timer reaches zero, a number of things can happen. First, an interrupt request may be signaled. This requires that the <tt class="docutils literal"><span class="pre">TA</span></tt> or <tt class="docutils literal"><span class="pre">TB</span></tt> bits in the register <tt class="docutils literal"><span class="pre">ICR</span></tt> be set. Secondly, an output can be signaled on <tt class="docutils literal"><span class="pre">PB6</span></tt> (for Timer A) or <tt class="docutils literal"><span class="pre">PB7</span></tt> (for Timer B). Details of this have already been discussed in the &quot;Parallel Data Ports&quot; section. Finally, the timer is reset and the decision is made to either stop there or to continue counting down. This is controlled by the <tt class="docutils literal"><span class="pre">RUNMODE</span></tt> bit in <tt class="docutils literal"><span class="pre">CRA</span></tt> or <tt class="docutils literal"><span class="pre">CRB</span></tt>. If this bit is <tt class="docutils literal"><span class="pre">0</span></tt>, the timer resets and continues running; if it is <tt class="docutils literal"><span class="pre">1</span></tt>, the timer still resets but does not re-run.</p>
<p>The four timer registers can be read at any time to see how many cycles remain for their respective timers. <em>Writing</em> to these registers is different. A write sets the value on a write-only shadow register of sorts that is associated with the actual register. When the register resets, the values in these shadow registers are what are loaded into the actual register. Hence, when writing to these registers, the values will not load into the actual register until the next underflow for that timer.</p>
<p>The load will happen immediately if the <tt class="docutils literal"><span class="pre">LOAD</span></tt> bit of either <tt class="docutils literal"><span class="pre">CRA</span></tt> or <tt class="docutils literal"><span class="pre">CRB</span></tt> are set. Whatever is in the countdown registers will be overwritten with whatever is in the shadow registers at that point, effectively starting the countdown over at the new value. The value of <tt class="docutils literal"><span class="pre">LOAD</span></tt> is not stored; it is a strobe that causes the registers to reload immediately when it is written.</p>
<p>Timer A may also be associated with the Serial Data Port. See that section below for more details.</p>

<h2><a class="toc-backref" id="time-of-day-clock" href="#time-of-day-clock">Time of Day Clock</a></h2><p>The Time of Day (TOD) clock is a much more human-friendly sort of timer. Rather than dealing with microseconds, the TOD's four registers store hours (<tt class="docutils literal"><span class="pre">TODHR</span></tt>), minutes (<tt class="docutils literal"><span class="pre">TODMIN</span></tt>), seconds (<tt class="docutils literal"><span class="pre">TODSEC</span></tt>), and tenths of seconds (<tt class="docutils literal"><span class="pre">TOD10TH</span></tt>). Once set, the TOD clock keeps accurate time as long as the signals on the clock pins are accurate.</p>
<p>Reading these registers reveals the current time, but it has to be done in a particular manner. Reading <tt class="docutils literal"><span class="pre">TODHR</span></tt> causes all of the registers to stop updating until <tt class="docutils literal"><span class="pre">TOD10TH</span></tt> is read. This is to ensure that all four registers can be read at the same &quot;time&quot;. Otherwise, it is possible (for example) to start reading the time at 1:59:59.9 and have time second tick over before the read is finished, making the first read happen before the hour changes and the others happen after. If this happened, the time would appear to be 1:00:00.0 when it really should be 2:00:00.0. The clock itself is not stopped during this pause; the clock merely doesn't update the registers until <tt class="docutils literal"><span class="pre">TOD10TH</span></tt> is next read.</p>
<p>Writing the TOD registers works the same way, with a couple of additional caveats. First, the clock itself stops after <tt class="docutils literal"><span class="pre">TODHR</span></tt> is written until <tt class="docutils literal"><span class="pre">TOD10TH</span></tt> is also written. Second, it is possible that writing to these registers doesn't change the time at all; if the <tt class="docutils literal"><span class="pre">ALARM</span></tt> bit of <tt class="docutils literal"><span class="pre">CRB</span></tt> is set, then writing these registers changes the <em>alarm</em>, which is kept in shadow registers that can't be read.</p>
<p>The four registers assume their data to be in a different kind of format: binary-coded decimal (BCD). In BCD, every four bits is used to represent a decimal digit rather than a hexadecimal digit. In this scheme, a register with the value <tt class="docutils literal"><span class="pre">0000 1001</span></tt> (<tt class="docutils literal"><span class="pre">$09</span></tt>), after incrementing, would hold the value <tt class="docutils literal"><span class="pre">0001 0000</span></tt> (<tt class="docutils literal"><span class="pre">$10</span></tt>) instead of the regular <tt class="docutils literal"><span class="pre">0000 1010</span></tt> (<tt class="docutils literal"><span class="pre">$0A</span></tt>). This means several values are invalid, which is never the case with regular binary numbers, but BCD is much easier to translate into straight decimal.</p>
<p>Because of this BCD formatting, we know that the top four bits of <tt class="docutils literal"><span class="pre">TOD10TH</span></tt> will always be <tt class="docutils literal"><span class="pre">0</span></tt> (since the highest number it will hold is <tt class="docutils literal"><span class="pre">$09</span></tt>). Similarly, the top bit of <tt class="docutils literal"><span class="pre">TODSEC</span></tt> and <tt class="docutils literal"><span class="pre">TODMIN</span></tt> (max values <tt class="docutils literal"><span class="pre">$59</span></tt>) will always be <tt class="docutils literal"><span class="pre">0</span></tt>. The top 3 bits of <tt class="docutils literal"><span class="pre">TODHR</span></tt> (max value <tt class="docutils literal"><span class="pre">$12</span></tt>; there is no support for 24-hour time) would be always <tt class="docutils literal"><span class="pre">0</span></tt> except that bit 7 (<tt class="docutils literal"><span class="pre">PM</span></tt>) is used to indicate AM (<tt class="docutils literal"><span class="pre">0</span></tt>) or PM (<tt class="docutils literal"><span class="pre">1</span></tt>).</p>
<p>The clock operates on external clock pulses fed to the <tt class="docutils literal"><span class="pre">TOD</span></tt> pin. By default, these pulses are expected to arrive at 60 Hz (in other words, <tt class="docutils literal"><span class="pre">TOD10TH</span></tt> will be incremented after every sixth pulse). If the <tt class="docutils literal"><span class="pre">TODIN</span></tt> bit of <tt class="docutils literal"><span class="pre">CRA</span></tt> is set, it will instead assume the clock frequency is 50 Hz (and <tt class="docutils literal"><span class="pre">TOD10TH</span></tt> will instead be updated every fifth clock pulse). Obviously, the accuracy of these pulses is important to having the correct time.</p>
<p>When the clock reaches the same time as set in the alarm, an interrupt request will be initiated if the <tt class="docutils literal"><span class="pre">ALRM</span></tt> bit of the <tt class="docutils literal"><span class="pre">ICR</span></tt> register is set. Whether or not the interrupt is requested, the TOD clock will simply keep ticking.</p>

<h2><a class="toc-backref" id="serial-data-port" href="#serial-data-port">Serial Data Port</a></h2><p>In addition to the two parallel data ports, the 6526 features a single bidirectional serial data port. The serial port operates by coordinating the <tt class="docutils literal"><span class="pre">SDR</span></tt> and <tt class="docutils literal"><span class="pre">CRA</span></tt> registers, Timer A, interrupts, and the <tt class="docutils literal"><span class="pre">SP</span></tt> and <tt class="docutils literal"><span class="pre">CNT</span></tt> pins.</p>
<p>Whether the serial port is being used to send or receive data is controlled by <tt class="docutils literal"><span class="pre">SPMODE</span></tt> bit of register <tt class="docutils literal"><span class="pre">CRA</span></tt> (<tt class="docutils literal"><span class="pre">0</span></tt> for receive and <tt class="docutils literal"><span class="pre">1</span></tt> for send). If receiving, the chip pushes a bit from the <tt class="docutils literal"><span class="pre">SP</span></tt> pin to an internal shift register every time the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin goes high (the sending device is responsible for signaling <tt class="docutils literal"><span class="pre">CNT</span></tt>). Once 8 bits have been received, they are deposited in the <tt class="docutils literal"><span class="pre">SDR</span></tt> register and an interrupt request is generated.</p>
<p>If the chip is sending, the contents of <tt class="docutils literal"><span class="pre">SDR</span></tt> are first pulled into the internal shift register. Timer A is used to clock the output; every <em>other</em> time that Timer A underflows, a bit will be taken from the shift register and put on the <tt class="docutils literal"><span class="pre">SP</span></tt> pin. At the same time, the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin will be set high to indicate that the bit is ready (this is why the clock rate is half the Timer A underflow rate; the other underflows are used to clear the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin.) Once the entire byte is sent, an interrupt request is generated; if the CPU had already put a new byte into <tt class="docutils literal"><span class="pre">SDR</span></tt> the transmission will continue, otherwise it will be paused until the next byte is ready.</p>

<h2><a class="toc-backref" id="control-registers" href="#control-registers">Control Registers</a></h2><p>Alongside the registers for the parallel ports, the interval timers, the TOD clock, and the serial port, the 6526 has three control registers. One controls the request of interrupts while the other two control the interval timers, the TOD clock, and the serial port.</p>

<h3><a class="toc-backref" id="control-registers-interrupt-control-register-icr" href="#control-registers-interrupt-control-register-icr">Interrupt Control Register (<tt class="docutils literal"><span class="pre">ICR</span></tt>)</a></h3><p>The ICR has different functions depending on whether it's being read from or written to. <em>Writing</em> to the ICR sets what interrupts should be responded to. <em>Reading</em> from the ICR reveals what interrupt conditions have been met and whether an interrupt request has actually been signaled.</p>
<p>When written, the ICR looks like this.</p>
<table border="1" class="docutils"><tr><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr>
<tr><td><tt class="docutils literal"><span class="pre">SC</span></tt></td><td>x</td><td>x</td><td><tt class="docutils literal"><span class="pre">FLG</span></tt></td><td><tt class="docutils literal"><span class="pre">SP</span></tt></td><td><tt class="docutils literal"><span class="pre">ALRM</span></tt></td><td><tt class="docutils literal"><span class="pre">TB</span></tt></td><td><tt class="docutils literal"><span class="pre">TA</span></tt></td></tr>
</table><p>Bits 0-4 are flags that represent the five sources of interrupts in the 6526:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre">TA</span></tt>: Timer A undeflow</li>
<li><tt class="docutils literal"><span class="pre">TB</span></tt>: Timer B undeflow</li>
<li><tt class="docutils literal"><span class="pre">ALRM</span></tt>: TOD Alarm</li>
<li><tt class="docutils literal"><span class="pre">SP</span></tt>: The <tt class="docutils literal"><span class="pre">SDR</span></tt> register being full (receive) or empty (send)</li>
<li><tt class="docutils literal"><span class="pre">FLG</span></tt>: The <tt class="docutils literal"><span class="pre">FLAG</span></tt> pin going low</li>
</ul>
<p>This marks the first appearance of the <tt class="docutils literal"><span class="pre">FLAG</span></tt> pin; this is simply a pin that potentially requests an interrupt when it goes low. A potential use of this is tying it to the <tt class="docutils literal"><span class="pre">PC</span></tt> pin of another 6526 to request an interrupt when parallel port data is sent or received (there is no interrupt bit for that).</p>
<p>These bits are masks. If a bit is set, that indicates that the event associated with that bit <em>will</em> fire an interrupt (i.e., the IRQ pin will go low) when that event happens. If that bit is cleared, the event is still recorded, but no interrupt request goes out.</p>
<p>The <tt class="docutils literal"><span class="pre">SC</span></tt> bit indicates whether the write is setting bits (<tt class="docutils literal"><span class="pre">1</span></tt>) or clearing them (<tt class="docutils literal"><span class="pre">0</span></tt>). Therefore, somewhat unintuitively, sending a <tt class="docutils literal"><span class="pre">0</span></tt> for a bit does not clear that bit; it leaves it unaffected. To set bits, one writes a value that has a <tt class="docutils literal"><span class="pre">1</span></tt> in the <tt class="docutils literal"><span class="pre">SC</span></tt> bit; i.e., writing <tt class="docutils literal"><span class="pre">$85</span></tt> (<tt class="docutils literal"><span class="pre">10000101</span></tt>) will set the <tt class="docutils literal"><span class="pre">ALRM</span></tt> and <tt class="docutils literal"><span class="pre">TA</span></tt> bits and leave the other bits unaffected.</p>
<p>The same works for clearing bits, except that the <tt class="docutils literal"><span class="pre">SC</span></tt> bit is <tt class="docutils literal"><span class="pre">0</span></tt> in that case. Similarly, writing <tt class="docutils literal"><span class="pre">$05</span></tt> (<tt class="docutils literal"><span class="pre">00000101</span></tt>) will <em>clear</em> the <tt class="docutils literal"><span class="pre">ALRM</span></tt> and <tt class="docutils literal"><span class="pre">TA</span></tt> bits and leave the others unchanged. This means that clearing every bit actually requires writing something like <tt class="docutils literal"><span class="pre">$1F</span></tt> (<tt class="docutils literal"><span class="pre">00011111</span></tt>, the values of bits 5 and 6 actually don't matter because they're not associated with any interrupt flags).</p>
<p>Reading the ICR looks a little different.</p>
<table border="1" class="docutils"><tr><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr>
<tr><td><tt class="docutils literal"><span class="pre">IR</span></tt></td><td>0</td><td>0</td><td><tt class="docutils literal"><span class="pre">FLG</span></tt></td><td><tt class="docutils literal"><span class="pre">SP</span></tt></td><td><tt class="docutils literal"><span class="pre">ALRM</span></tt></td><td><tt class="docutils literal"><span class="pre">TB</span></tt></td><td><tt class="docutils literal"><span class="pre">TA</span></tt></td></tr>
</table><p>Bits 0-4 are the same names as when writing the register. In reading, however, they indicate that the event they're associated with <em>has actually happened</em> since the last time the <tt class="docutils literal"><span class="pre">ICR</span></tt> was read. The appropriate bit(s) will be set no matter what the interrupt mask settings that have been written.</p>
<p>The masks instead affect the <tt class="docutils literal"><span class="pre">IR</span></tt> bit. If the event happened <em>and</em> the <tt class="docutils literal"><span class="pre">ICR</span></tt> had been written with a value that turned the bit for that event on, then the <tt class="docutils literal"><span class="pre">IR</span></tt> bit will also be set and the <tt class="docutils literal"><span class="pre">IRQ</span></tt> pin will go low.</p>
<p>Here is an example for illustration. The reset state of the 6526 has all interrupt masks set to <tt class="docutils literal"><span class="pre">0</span></tt>. If <tt class="docutils literal"><span class="pre">$82</span></tt> (<tt class="docutils literal"><span class="pre">10000010</span></tt>) is written to the register, then the Timer B mask will be turned on and all the others will remain off. If Timer B was then set to count exactly two Timer A underflows (<tt class="docutils literal"><span class="pre">TBLO</span></tt> is <tt class="docutils literal"><span class="pre">$02</span></tt>, <tt class="docutils literal"><span class="pre">TBHI</span></tt> is <tt class="docutils literal"><span class="pre">$00</span></tt>, and the <tt class="docutils literal"><span class="pre">INMODE1</span></tt> and <tt class="docutils literal"><span class="pre">INMODE0</span></tt> bits of <tt class="docutils literal"><span class="pre">CRB</span></tt> are set to <tt class="docutils literal"><span class="pre">10</span></tt>), then the first Timer A underflow will only request an interrupt for Timer A and the second will request for both.</p>
<p>In this scenario, when Timer A underflows for the first time, the <tt class="docutils literal"><span class="pre">IRQ</span></tt> pin will not be low and reading the <tt class="docutils literal"><span class="pre">ICR</span></tt> will yield <tt class="docutils literal"><span class="pre">$01</span></tt> (<tt class="docutils literal"><span class="pre">00000001</span></tt>). The Timer A underflow has happened (hence the <tt class="docutils literal"><span class="pre">TA</span></tt> bit being set when reading the <tt class="docutils literal"><span class="pre">ICR</span></tt>), but no interrupt has actually been requested (the <tt class="docutils literal"><span class="pre">IR</span></tt> bit is <tt class="docutils literal"><span class="pre">0</span></tt> and the <tt class="docutils literal"><span class="pre">IRQ</span></tt> pin is not low). This is because the Timer A mask, set by writing the <tt class="docutils literal"><span class="pre">ICR</span></tt>, was never set to <tt class="docutils literal"><span class="pre">1</span></tt>.</p>
<p>The <em>next</em> time Timer A underflows, it also causes a Timer B underflow (since the latter was set to count 2 Timer A underflows). This time, the <tt class="docutils literal"><span class="pre">IRQ</span></tt> pin <em>will</em> go low, and reading the <tt class="docutils literal"><span class="pre">ICR</span></tt> will produce <tt class="docutils literal"><span class="pre">$83</span></tt> (<tt class="docutils literal"><span class="pre">10000011</span></tt>). The <tt class="docutils literal"><span class="pre">TA</span></tt> and <tt class="docutils literal"><span class="pre">TB</span></tt> bits are both set, and the <tt class="docutils literal"><span class="pre">IR</span></tt> bit is also set, because the Timer B mask was set to <tt class="docutils literal"><span class="pre">1</span></tt> (the <tt class="docutils literal"><span class="pre">TA</span></tt> bit is set because a Timer A event happened, but the Timer B event is what actually set <tt class="docutils literal"><span class="pre">IR</span></tt>).</p>
<p>Reading the <tt class="docutils literal"><span class="pre">ICR</span></tt> will reset its value (just its read value; the masks will remain the same) and reset the <tt class="docutils literal"><span class="pre">IRQ</span></tt> pin.</p>

<h3><a class="toc-backref" id="control-registers-control-register-a-cra" href="#control-registers-control-register-a-cra">Control Register A (<tt class="docutils literal"><span class="pre">CRA</span></tt>)</a></h3><p>This control register handles Timer A, the serial port, and the frequency of the TOD clock.</p>
<table border="1" class="docutils"><tr><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr>
<tr><td><tt class="docutils literal"><span class="pre">TODIN</span></tt></td><td><tt class="docutils literal"><span class="pre">SPMODE</span></tt></td><td><tt class="docutils literal"><span class="pre">INMODE</span></tt></td><td><tt class="docutils literal"><span class="pre">LOAD</span></tt></td><td><tt class="docutils literal"><span class="pre">RUNMODE</span></tt></td><td><tt class="docutils literal"><span class="pre">OUTMODE</span></tt></td><td><tt class="docutils literal"><span class="pre">PBON</span></tt></td><td><tt class="docutils literal"><span class="pre">START</span></tt></td></tr>
</table><p>The <tt class="docutils literal"><span class="pre">START</span></tt> bit indicates whether Timer A is running. If it's at <tt class="docutils literal"><span class="pre">0</span></tt>, setting it to <tt class="docutils literal"><span class="pre">1</span></tt> is what starts the timer. If Timer Ais in one-shot mode (see <tt class="docutils literal"><span class="pre">RUNMODE</span></tt> below), then when it underflows, this bit will be automatically cleared.</p>
<p>The <tt class="docutils literal"><span class="pre">PBON</span></tt> bit can be set to <tt class="docutils literal"><span class="pre">1</span></tt> to have Timer A send output to pin <tt class="docutils literal"><span class="pre">PB6</span></tt>. If this bit is <tt class="docutils literal"><span class="pre">0</span></tt> then <tt class="docutils literal"><span class="pre">PB6</span></tt> operates normally.</p>
<p>The <tt class="docutils literal"><span class="pre">OUTMODE</span></tt> bit says what kind of output <tt class="docutils literal"><span class="pre">PB6</span></tt> will have if it's set to be the Timer A output with PBON. If this is <tt class="docutils literal"><span class="pre">0</span></tt>, then <tt class="docutils literal"><span class="pre">PB6</span></tt> will go high for one clock cycle when Timer A underflows. If it's <tt class="docutils literal"><span class="pre">1</span></tt>, then <tt class="docutils literal"><span class="pre">PB6</span></tt> will toggle between high and low each time Timer A underflows.</p>
<p>The <tt class="docutils literal"><span class="pre">RUNMODE</span></tt> bit determines what happens to Timer A itself after it underflows. A <tt class="docutils literal"><span class="pre">0</span></tt> here means continuous mode, where the timer will reset and continue running. If it's <tt class="docutils literal"><span class="pre">1</span></tt>, the timer will reset after underflow but will stop (setting <tt class="docutils literal"><span class="pre">START</span></tt> to <tt class="docutils literal"><span class="pre">0</span></tt> in the process).</p>
<p>The <tt class="docutils literal"><span class="pre">LOAD</span></tt> bit is a strobe. It is not saved (on read, this bit will always be <tt class="docutils literal"><span class="pre">0</span></tt>, and writing a <tt class="docutils literal"><span class="pre">0</span></tt> to it has no effect). When <tt class="docutils literal"><span class="pre">CRA</span></tt> is written with a <tt class="docutils literal"><span class="pre">1</span></tt> in this bit position, the contents of the shadow register for each timer register will be immediately loaded into its respective timer register. In this way, the timers can be reset without having to wait for them to underflow (which is the only other way that the contents of the registers are reset).</p>
<p>The <tt class="docutils literal"><span class="pre">INMODE</span></tt> bit determines what Timer A actually counts. If this is <tt class="docutils literal"><span class="pre">0</span></tt>, Timer A counts pulses on the <tt class="docutils literal"><span class="pre">PHI2</span></tt> pin (the system clock). If this is <tt class="docutils literal"><span class="pre">1</span></tt>, Timer A counts pulses on the <tt class="docutils literal"><span class="pre">CNT</span></tt> pin (which has no fixed function; any external circuit can provide pulses for <tt class="docutils literal"><span class="pre">CNT</span></tt>).</p>
<p>The <tt class="docutils literal"><span class="pre">SPMODE</span></tt> bit determines whether the serial port is receiving (<tt class="docutils literal"><span class="pre">0</span></tt>) or sending (<tt class="docutils literal"><span class="pre">1</span></tt>).</p>
<p>Finally, the <tt class="docutils literal"><span class="pre">TODIN</span></tt> bit sets the TOD clock frequency to 60Hz (<tt class="docutils literal"><span class="pre">0</span></tt>) or 50Hz (<tt class="docutils literal"><span class="pre">1</span></tt>). This does not, of course, change the actual clock frequency on the TOD pin; this clock is supplied externally. It simply changes how the TOD clock interprets those pulses. (In other words, setting this to 50Hz while supplying a 60Hz external clock will make for a TOD clock that runs very fast.)</p>

<h3><a class="toc-backref" id="control-registers-control-register-b-crb" href="#control-registers-control-register-b-crb">Control Register B (<tt class="docutils literal"><span class="pre">CRB</span></tt>)</a></h3><p>This control register handles Timer B and the setting of the TOD registers.</p>
<table border="1" class="docutils"><tr><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr>
<tr><td><tt class="docutils literal"><span class="pre">ALARM</span></tt></td><td><tt class="docutils literal"><span class="pre">INMODE1</span></tt></td><td><tt class="docutils literal"><span class="pre">INMODE0</span></tt></td><td><tt class="docutils literal"><span class="pre">LOAD</span></tt></td><td><tt class="docutils literal"><span class="pre">RUNMODE</span></tt></td><td><tt class="docutils literal"><span class="pre">OUTMODE</span></tt></td><td><tt class="docutils literal"><span class="pre">PBON</span></tt></td><td><tt class="docutils literal"><span class="pre">START</span></tt></td></tr>
</table><p>The lower 5 bits of this register are identical to the lower 5 bits of <tt class="docutils literal"><span class="pre">CRA</span></tt> except that they affect Timer B instead of timer A, and that <tt class="docutils literal"><span class="pre">PBON</span></tt> sets the behavior of pin <tt class="docutils literal"><span class="pre">PB7</span></tt> rather than <tt class="docutils literal"><span class="pre">PB6</span></tt>.</p>
<p>In this register, <tt class="docutils literal"><span class="pre">INMODE</span></tt> takes two bits (marked <tt class="docutils literal"><span class="pre">INMODE0</span></tt> for the lower bit and <tt class="docutils literal"><span class="pre">INMODE1</span></tt> for the upper). This is because in addition to the two events that Timer A can count, Timer B can count two more.</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre">00</span></tt>: System clock (<tt class="docutils literal"><span class="pre">PHI2</span></tt> pin) pulses</li>
<li><tt class="docutils literal"><span class="pre">01</span></tt>: <tt class="docutils literal"><span class="pre">CNT</span></tt> pin pulses</li>
<li><tt class="docutils literal"><span class="pre">10</span></tt>: Timer A underflows</li>
<li><tt class="docutils literal"><span class="pre">11</span></tt>: Timer A underflows that happen when <tt class="docutils literal"><span class="pre">CNT</span></tt> is high</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">ALARM</span></tt> bit determines what a write to TOD registers actually does. If this is <tt class="docutils literal"><span class="pre">0</span></tt>, the TOD registers are written normally. If it's <tt class="docutils literal"><span class="pre">1</span></tt>, then a write to the TOD registers is actually setting the TOD alarm (held in unreadable shadow registers).</p>

<h2><a class="toc-backref" id="pin-interface" href="#pin-interface">Pin Interface</a></h2><p>Many of the pins have already been covered, but there's still a bit more to talk about.</p>
<p>One important matter on pins that <em>have</em> been covered is that the parallel port pins <tt class="docutils literal"><span class="pre">PA0</span></tt>-<tt class="docutils literal"><span class="pre">PA7</span></tt> and <tt class="docutils literal"><span class="pre">PB0</span></tt>-<tt class="docutils literal"><span class="pre">PB7</span></tt> are internally pulled up. If nothing is connected to them or if no data is coming into an input pin, that pin will read as a <tt class="docutils literal"><span class="pre">1</span></tt> when the <tt class="docutils literal"><span class="pre">PRA</span></tt> or <tt class="docutils literal"><span class="pre">PRB</span></tt> registers are read.</p>
<p>Those registers are actually physically read and written through the address pins <tt class="docutils literal"><span class="pre">A0</span></tt>-<tt class="docutils literal"><span class="pre">A3</span></tt> and the data pins <tt class="docutils literal"><span class="pre">D0</span></tt>-<tt class="docutils literal"><span class="pre">D7</span></tt>. The offset listed in the very first table in this description is what must be on the <tt class="docutils literal"><span class="pre">A</span></tt> pins, while the <tt class="docutils literal"><span class="pre">D</span></tt> pins either have the data to write to that register or are set to the data to be read. Whether an operation is to be a read or write is actually set by the <tt class="docutils literal"><span class="pre">R_W</span></tt> pin.</p>
<p><tt class="docutils literal"><span class="pre">RES</span></tt> resets the chip when it's held low. Resetting makes all registers go to <tt class="docutils literal"><span class="pre">$00</span></tt> (which, as a side effect, sets all parallel port pins to inputs, stops the timers, etc.) except for the interval timer registers, which are all set to <tt class="docutils literal"><span class="pre">$FF</span></tt>.</p>
<p>Finally, there is an active low chip select pin <tt class="docutils literal"><span class="pre">CS</span></tt>. Most of the chip continues functioning (running down interval timers, keeping track of the TOD, receiving data on ports, etc.) at all times. The <tt class="docutils literal"><span class="pre">CS</span></tt> simply must be low to do a read from or a write to the registers.</p>
<p>The chip comes in a 40-pin dual in-line package with the following pin assignments.</p>
<p><pre class="listing">
        +-----+--+-----+
    VSS |1    +--+   40| CNT
    PA0 |2           39| SP
    PA1 |3           38| A0
    PA2 |4           37| A1
    PA3 |5           36| A2
    PA4 |6           35| A3
    PA5 |7           34| RES
    PA6 |8           33| D0
    PA7 |9           32| D1
    PB0 |10          31| D2
    PB1 |11   6526   30| D3
    PB2 |12          29| D4
    PB3 |13          28| D5
    PB4 |14          27| D6
    PB5 |15          26| D7
    PB6 |16          25| PHI2
    PB7 |17          24| FLAG
     PC |18          23| CS
    TOD |19          22| R_W
    VCC |20          21| IRQ
        +--------------+
</pre> Pin assignments are explained below.</p>
<table border="1" class="docutils"><tr><th>Pin</th><th>Name</th><th>Description</th></tr>
<tr><td>1</td><td><tt class="docutils literal"><span class="pre">VSS</span></tt></td><td>0V power supply (ground). Not emulated.</td></tr>
<tr><td>2</td><td><tt class="docutils literal"><span class="pre">PA0</span></tt></td><td>Parallel port A pin 0.</td></tr>
<tr><td>3</td><td><tt class="docutils literal"><span class="pre">PA1</span></tt></td><td>Parallel port A pin 1.</td></tr>
<tr><td>4</td><td><tt class="docutils literal"><span class="pre">PA2</span></tt></td><td>Parallel port A pin 2.</td></tr>
<tr><td>5</td><td><tt class="docutils literal"><span class="pre">PA3</span></tt></td><td>Parallel port A pin 3.</td></tr>
<tr><td>6</td><td><tt class="docutils literal"><span class="pre">PA4</span></tt></td><td>Parallel port A pin 4.</td></tr>
<tr><td>7</td><td><tt class="docutils literal"><span class="pre">PA5</span></tt></td><td>Parallel port A pin 5.</td></tr>
<tr><td>8</td><td><tt class="docutils literal"><span class="pre">PA6</span></tt></td><td>Parallel port A pin 6.</td></tr>
<tr><td>9</td><td><tt class="docutils literal"><span class="pre">PA7</span></tt></td><td>Parallel port A pin 7.</td></tr>
<tr><td>10</td><td><tt class="docutils literal"><span class="pre">PB0</span></tt></td><td>Parallel port B pin 0.</td></tr>
<tr><td>11</td><td><tt class="docutils literal"><span class="pre">PB1</span></tt></td><td>Parallel port B pin 1.</td></tr>
<tr><td>12</td><td><tt class="docutils literal"><span class="pre">PB2</span></tt></td><td>Parallel port B pin 2.</td></tr>
<tr><td>13</td><td><tt class="docutils literal"><span class="pre">PB3</span></tt></td><td>Parallel port B pin 3.</td></tr>
<tr><td>14</td><td><tt class="docutils literal"><span class="pre">PB4</span></tt></td><td>Parallel port B pin 4.</td></tr>
<tr><td>15</td><td><tt class="docutils literal"><span class="pre">PB5</span></tt></td><td>Parallel port B pin 5.</td></tr>
<tr><td>16</td><td><tt class="docutils literal"><span class="pre">PB6</span></tt></td><td>Parallel port B pin 6.</td></tr>
<tr><td>17</td><td><tt class="docutils literal"><span class="pre">PB7</span></tt></td><td>Parallel port B pin 7.</td></tr>
<tr><td>18</td><td><tt class="docutils literal"><span class="pre">PC</span></tt></td><td>Handshaking output. Goes low for a cycle when <tt class="docutils literal"><span class="pre">PRB</span></tt> is read or written.</td></tr>
<tr><td>19</td><td><tt class="docutils literal"><span class="pre">TOD</span></tt></td><td>Time-of-day clock input. Should be 50 or 60Hz.</td></tr>
<tr><td>20</td><td><tt class="docutils literal"><span class="pre">VCC</span></tt></td><td>+5V power supply. Not emulated.</td></tr>
<tr><td>21</td><td><tt class="docutils literal"><span class="pre">IRQ</span></tt></td><td>Interrupt request. Set low each time an interrupt condition is met.</td></tr>
<tr><td>22</td><td><tt class="docutils literal"><span class="pre">R_W</span></tt></td><td>Read (<tt class="docutils literal"><span class="pre">1</span></tt>) and write (<tt class="docutils literal"><span class="pre">0</span></tt>) control for the registers.</td></tr>
<tr><td>23</td><td><tt class="docutils literal"><span class="pre">CS</span></tt></td><td>Chip select. Must be low to read or write registers.</td></tr>
<tr><td>24</td><td><tt class="docutils literal"><span class="pre">FLAG</span></tt></td><td>Handshaking input pin. Setting low can trigger an interrupt.</td></tr>
<tr><td>25</td><td><tt class="docutils literal"><span class="pre">PHI2</span></tt></td><td>Clock input. Should be 1MHz; other values will affect timer accuracy.</td></tr>
<tr><td>26</td><td><tt class="docutils literal"><span class="pre">D7</span></tt></td><td>Data pin 7.</td></tr>
<tr><td>27</td><td><tt class="docutils literal"><span class="pre">D6</span></tt></td><td>Data pin 6.</td></tr>
<tr><td>28</td><td><tt class="docutils literal"><span class="pre">D5</span></tt></td><td>Data pin 5.</td></tr>
<tr><td>29</td><td><tt class="docutils literal"><span class="pre">D4</span></tt></td><td>Data pin 4.</td></tr>
<tr><td>30</td><td><tt class="docutils literal"><span class="pre">D3</span></tt></td><td>Data pin 3.</td></tr>
<tr><td>31</td><td><tt class="docutils literal"><span class="pre">D2</span></tt></td><td>Data pin 2.</td></tr>
<tr><td>32</td><td><tt class="docutils literal"><span class="pre">D1</span></tt></td><td>Data pin 1.</td></tr>
<tr><td>33</td><td><tt class="docutils literal"><span class="pre">D0</span></tt></td><td>Data pin 0.</td></tr>
<tr><td>34</td><td><tt class="docutils literal"><span class="pre">RES</span></tt></td><td>Reset. When this goes low, the chip resets.</td></tr>
<tr><td>35</td><td><tt class="docutils literal"><span class="pre">A3</span></tt></td><td>Address pin 3.</td></tr>
<tr><td>36</td><td><tt class="docutils literal"><span class="pre">A2</span></tt></td><td>Address pin 2.</td></tr>
<tr><td>37</td><td><tt class="docutils literal"><span class="pre">A1</span></tt></td><td>Address pin 1.</td></tr>
<tr><td>38</td><td><tt class="docutils literal"><span class="pre">A0</span></tt></td><td>Address pin 0.</td></tr>
<tr><td>39</td><td><tt class="docutils literal"><span class="pre">SP</span></tt></td><td>Serial port.</td></tr>
<tr><td>40</td><td><tt class="docutils literal"><span class="pre">CNT</span></tt></td><td>Counter. Used to potentially clock the serial port or either timer.</td></tr>
</table><p>In the Commodore 64, U1 and U2 are both 6526s (called CIA1 and CIA2 respectively). CIA1 controls the keyboard and control (game) ports, along with providing an interrupt (via its <tt class="docutils literal"><span class="pre">FLAG</span></tt> pin) that fires when the cassette is ready to be read. CIA2 controls the user port and the serial port, along with the RESTORE key on the keyboard. It also provides the upper two address pins to the VIC programmatically via the kernal code. CIA2's interrupts are tied to the CPU's <tt class="docutils literal"><span class="pre">NMI</span></tt> pin rather than the regular <tt class="docutils literal"><span class="pre">IRQ</span></tt> pin, so they will be handled immediately even if the CPU is masking interrupts.</p>
<p>Registers for CIA1 are available at addresses <tt class="docutils literal"><span class="pre">$DC00</span></tt> to <tt class="docutils literal"><span class="pre">$DCFF</span></tt>, and regisers for CIA2 are available at addresses <tt class="docutils literal"><span class="pre">$DD00</span></tt> to <tt class="docutils literal"><span class="pre">$DDFF</span></tt>. These 256-address blocks are much more than is necessary for the 16 registers on each chip. The registers instead appear to repeat every 16 addresses; reading <tt class="docutils literal"><span class="pre">$DD0C</span></tt> will read the <tt class="docutils literal"><span class="pre">SDR</span></tt> register of CIA2, but so will reading <tt class="docutils literal"><span class="pre">$DD1C</span></tt>, <tt class="docutils literal"><span class="pre">$DD2C</span></tt>, etc. It's recommended to ignore this &quot;feature&quot; and simply use the base address for each register.</p>
</p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../utils.html">../utils</a>, <a class="reference external" href="../components/chip.html">../components/chip</a>, <a class="reference external" href="../components/link.html">../components/link</a>, <a class="reference external" href="ic6526/constants.html">ic6526/constants</a>, <a class="reference external" href="../components/pins.html">../components/pins</a>, <a class="reference external" href="../components/registers.html">../components/registers</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="Ic6526"></a>
<dt><pre><a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>
  <span class="Identifier">pins</span><span class="Other">:</span> <a href="../components/pins.html#Pins"><span class="Identifier">Pins</span></a>
  <span class="Identifier">registers</span><span class="Other">:</span> <a href="../components/registers.html#Registers"><span class="Identifier">Registers</span></a>
</pre></dt>
<dd>



</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="registers,Ic6526"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#registers%2CIc6526"><span class="Identifier">registers</span></a><span class="Other">(</span><span class="Identifier">chip`gensym1</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="../components/registers.html#RegisterInfo"><span class="Identifier">RegisterInfo</span></a><span class="Other">]</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns a read-only view of the chip's registers.

</dd>
<a id="[],Ic6526,int"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#%5B%5D%2CIc6526%2Cint"><span class="Identifier">`[]`</span></a><span class="Other">(</span><span class="Identifier">chip`gensym0</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a><span class="Other">;</span> <span class="Identifier">index`gensym0</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">)</span><span class="Other">:</span> <a href="../components/link.html#Pin"><span class="Identifier">Pin</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Looks up a pin by the pin's number.

</dd>
<a id="[],Ic6526,string"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#%5B%5D%2CIc6526%2Cstring"><span class="Identifier">`[]`</span></a><span class="Other">(</span><span class="Identifier">chip`gensym0</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a><span class="Other">;</span> <span class="Identifier">index`gensym0</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">)</span><span class="Other">:</span> <a href="../components/link.html#Pin"><span class="Identifier">Pin</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span>
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">KeyError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Looks up a pin by the pin's name.

</dd>
<a id="pins,Ic6526"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#pins%2CIc6526"><span class="Identifier">pins</span></a><span class="Other">(</span><span class="Identifier">chip`gensym0</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="../components/pins.html#PinInfo"><span class="Identifier">PinInfo</span></a><span class="Other">]</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns a read-only view of the chip's pins.

</dd>
<a id="newIc6526"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#newIc6526"><span class="Identifier">newIc6526</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">KeyError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">]</span><span class="Other">,</span>
                           <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>



</dd>

</dl></div>
<div class="section" id="15">
<h1><a class="toc-backref" href="#15">Iterators</a></h1>
<dl class="item">
<a id="items.i,Ic6526"></a>
<dt><pre><span class="Keyword">iterator</span> <a href="#items.i%2CIc6526"><span class="Identifier">items</span></a><span class="Other">(</span><span class="Identifier">chip`gensym0</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a><span class="Other">)</span><span class="Other">:</span> <a href="../components/link.html#Pin"><span class="Identifier">Pin</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Iterates over the chip's pins, yielding them in order by pin number.

</dd>
<a id="pairs.i,Ic6526"></a>
<dt><pre><span class="Keyword">iterator</span> <a href="#pairs.i%2CIc6526"><span class="Identifier">pairs</span></a><span class="Other">(</span><span class="Identifier">chip`gensym0</span><span class="Other">:</span> <a href="ic6526.html#Ic6526"><span class="Identifier">Ic6526</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Other">(</span><span class="Identifier">int</span><span class="Other">,</span> <a href="../components/link.html#Pin"><span class="Identifier">Pin</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Iterates over the chip's pins, yielding both the pin number and the pin itself.

</dd>

</dl></div>
<div class="section" id="19">
<h1><a class="toc-backref" href="#19">Exports</a></h1>
<dl class="item">
<a href="ic6526/constants.html#SP"><span class="Identifier">SP</span></a>, <a href="ic6526/constants.html#D5"><span class="Identifier">D5</span></a>, <a href="ic6526/constants.html#D2"><span class="Identifier">D2</span></a>, <a href="ic6526/constants.html#TBLO"><span class="Identifier">TBLO</span></a>, <a href="ic6526/constants.html#SC"><span class="Identifier">SC</span></a>, <a href="ic6526/constants.html#A2"><span class="Identifier">A2</span></a>, <a href="ic6526/constants.html#TA"><span class="Identifier">TA</span></a>, <a href="ic6526/constants.html#ALRM"><span class="Identifier">ALRM</span></a>, <a href="ic6526/constants.html#R_W"><span class="Identifier">R_W</span></a>, <a href="ic6526/constants.html#PA2"><span class="Identifier">PA2</span></a>, <a href="ic6526/constants.html#VCC"><span class="Identifier">VCC</span></a>, <a href="ic6526/constants.html#PBON"><span class="Identifier">PBON</span></a>, <a href="ic6526/constants.html#PB6"><span class="Identifier">PB6</span></a>, <a href="ic6526/constants.html#D3"><span class="Identifier">D3</span></a>, <a href="ic6526/constants.html#TODIN"><span class="Identifier">TODIN</span></a>, <a href="ic6526/constants.html#RUNMODE"><span class="Identifier">RUNMODE</span></a>, <a href="ic6526/constants.html#CS"><span class="Identifier">CS</span></a>, <a href="ic6526/constants.html#IR"><span class="Identifier">IR</span></a>, <a href="ic6526/constants.html#TAHI"><span class="Identifier">TAHI</span></a>, <a href="ic6526/constants.html#PA5"><span class="Identifier">PA5</span></a>, <a href="ic6526/constants.html#DDRB"><span class="Identifier">DDRB</span></a>, <a href="ic6526/constants.html#ALARM"><span class="Identifier">ALARM</span></a>, <a href="ic6526/constants.html#CRB"><span class="Identifier">CRB</span></a>, <a href="ic6526/constants.html#PC"><span class="Identifier">PC</span></a>, <a href="ic6526/constants.html#A3"><span class="Identifier">A3</span></a>, <a href="ic6526/constants.html#TBHI"><span class="Identifier">TBHI</span></a>, <a href="ic6526/constants.html#PA0"><span class="Identifier">PA0</span></a>, <a href="ic6526/constants.html#A1"><span class="Identifier">A1</span></a>, <a href="ic6526/constants.html#TODSEC"><span class="Identifier">TODSEC</span></a>, <a href="ic6526/constants.html#DDRA"><span class="Identifier">DDRA</span></a>, <a href="ic6526/constants.html#D4"><span class="Identifier">D4</span></a>, <a href="ic6526/constants.html#PB7"><span class="Identifier">PB7</span></a>, <a href="ic6526/constants.html#PRB"><span class="Identifier">PRB</span></a>, <a href="ic6526/constants.html#VSS"><span class="Identifier">VSS</span></a>, <a href="ic6526/constants.html#IRQ"><span class="Identifier">IRQ</span></a>, <a href="ic6526/constants.html#PA3"><span class="Identifier">PA3</span></a>, <a href="ic6526/constants.html#INMODE"><span class="Identifier">INMODE</span></a>, <a href="ic6526/constants.html#CRA"><span class="Identifier">CRA</span></a>, <a href="ic6526/constants.html#SDR"><span class="Identifier">SDR</span></a>, <a href="ic6526/constants.html#A0"><span class="Identifier">A0</span></a>, <a href="ic6526/constants.html#TOD"><span class="Identifier">TOD</span></a>, <a href="ic6526/constants.html#FLAG"><span class="Identifier">FLAG</span></a>, <a href="ic6526/constants.html#PRA"><span class="Identifier">PRA</span></a>, <a href="ic6526/constants.html#RES"><span class="Identifier">RES</span></a>, <a href="ic6526/constants.html#TB"><span class="Identifier">TB</span></a>, <a href="ic6526/constants.html#FLG"><span class="Identifier">FLG</span></a>, <a href="ic6526/constants.html#PHI2"><span class="Identifier">PHI2</span></a>, <a href="ic6526/constants.html#PA1"><span class="Identifier">PA1</span></a>, <a href="ic6526/constants.html#PA6"><span class="Identifier">PA6</span></a>, <a href="ic6526/constants.html#PB3"><span class="Identifier">PB3</span></a>, <a href="ic6526/constants.html#TOD10TH"><span class="Identifier">TOD10TH</span></a>, <a href="ic6526/constants.html#PB5"><span class="Identifier">PB5</span></a>, <a href="ic6526/constants.html#D1"><span class="Identifier">D1</span></a>, <a href="ic6526/constants.html#CNT"><span class="Identifier">CNT</span></a>, <a href="ic6526/constants.html#TODMIN"><span class="Identifier">TODMIN</span></a>, <a href="ic6526/constants.html#D7"><span class="Identifier">D7</span></a>, <a href="ic6526/constants.html#SPMODE"><span class="Identifier">SPMODE</span></a>, <a href="ic6526/constants.html#OUTMODE"><span class="Identifier">OUTMODE</span></a>, <a href="ic6526/constants.html#D6"><span class="Identifier">D6</span></a>, <a href="ic6526/constants.html#PB0"><span class="Identifier">PB0</span></a>, <a href="ic6526/constants.html#TALO"><span class="Identifier">TALO</span></a>, <a href="ic6526/constants.html#TODHR"><span class="Identifier">TODHR</span></a>, <a href="ic6526/constants.html#SPI"><span class="Identifier">SPI</span></a>, <a href="ic6526/constants.html#D0"><span class="Identifier">D0</span></a>, <a href="ic6526/constants.html#PM"><span class="Identifier">PM</span></a>, <a href="ic6526/constants.html#PA7"><span class="Identifier">PA7</span></a>, <a href="ic6526/constants.html#PB2"><span class="Identifier">PB2</span></a>, <a href="ic6526/constants.html#ICR"><span class="Identifier">ICR</span></a>, <a href="ic6526/constants.html#INMODE0"><span class="Identifier">INMODE0</span></a>, <a href="ic6526/constants.html#PA4"><span class="Identifier">PA4</span></a>, <a href="ic6526/constants.html#LOAD"><span class="Identifier">LOAD</span></a>, <a href="ic6526/constants.html#INMODE1"><span class="Identifier">INMODE1</span></a>, <a href="ic6526/constants.html#PB1"><span class="Identifier">PB1</span></a>, <a href="ic6526/constants.html#PB4"><span class="Identifier">PB4</span></a>, <a href="ic6526/constants.html#START"><span class="Identifier">START</span></a>
</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2021-08-09 13:37:42 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
