<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>nim64/chips/ic6567/memory</title>
<link rel="stylesheet" type="text/css" href="../../../nimdoc.out.css">

<script type="text/javascript" src="../../../dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);

  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true;
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">nim64/chips/ic6567/memory</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    <li>
      <a href="../../../theindex.html">Index</a>
    </li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#MemoryController"
    title="MemoryController = ref object
  pins: Pins
  registers: Registers
  counter: RasterCounter
  char_ptrs: seq[uint]
  mob_ptr: uint
  refresh: uint
  vcrc: VcRc
  mcs: seq[Mc]">MemoryController</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">new_memory_controller
      <li><a class="reference" href="#new_memory_controller%2CRasterCounter%2CPins%2CRegisters"
    title="new_memory_controller(counter: RasterCounter; pins: Pins; registers: Registers): MemoryController">new_memory_controller,<wbr>RasterCounter,<wbr>Pins,<wbr>Registers</a></li>

  </ul>
  <ul class="simple nested-toc-section">pre_read
      <li><a class="reference" href="#pre_read%2CMemoryController"
    title="pre_read(memory: MemoryController)">pre_read,<wbr>MemoryController</a></li>

  </ul>
  <ul class="simple nested-toc-section">generate_address
      <li><a class="reference" href="#generate_address%2CMemoryController"
    title="generate_address(memory: MemoryController): (AccessType, uint)">generate_address,<wbr>MemoryController</a></li>

  </ul>
  <ul class="simple nested-toc-section">high_to_pins
      <li><a class="reference" href="#high_to_pins%2CMemoryController%2Cuint"
    title="high_to_pins(memory: MemoryController; address: uint)">high_to_pins,<wbr>MemoryController,<wbr>uint</a></li>

  </ul>
  <ul class="simple nested-toc-section">read
      <li><a class="reference" href="#read%2CMemoryController%2CAccessType"
    title="read(memory: MemoryController; access: AccessType): uint">read,<wbr>MemoryController,<wbr>AccessType</a></li>

  </ul>
  <ul class="simple nested-toc-section">clear_yexp
      <li><a class="reference" href="#clear_yexp%2CMemoryController%2Cuint"
    title="clear_yexp(memory: MemoryController; cleared: uint)">clear_yexp,<wbr>MemoryController,<wbr>uint</a></li>

  </ul>
  <ul class="simple nested-toc-section">low_to_pins
      <li><a class="reference" href="#low_to_pins%2CMemoryController%2Cuint"
    title="low_to_pins(memory: MemoryController; address: uint)">low_to_pins,<wbr>MemoryController,<wbr>uint</a></li>

  </ul>

  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"></p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../../utils.html">../../utils</a>, <a class="reference external" href="../../components/link.html">../../components/link</a>, <a class="reference external" href="../../components/pins.html">../../components/pins</a>, <a class="reference external" href="../../components/registers.html">../../components/registers</a>, <a class="reference external" href="access.html">access</a>, <a class="reference external" href="constants.html">constants</a>, <a class="reference external" href="mc.html">mc</a>, <a class="reference external" href="raster.html">raster</a>, <a class="reference external" href="vcrc.html">vcrc</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="MemoryController"></a>
<dt><pre><a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>
  <span class="Identifier">pins</span><span class="Other">:</span> <a href="../../components/pins.html#Pins"><span class="Identifier">Pins</span></a>
  <span class="Identifier">registers</span><span class="Other">:</span> <a href="../../components/registers.html#Registers"><span class="Identifier">Registers</span></a>
  <span class="Identifier">counter</span><span class="Other">:</span> <a href="raster.html#RasterCounter"><span class="Identifier">RasterCounter</span></a>
  <span class="Identifier">char_ptrs</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">uint</span><span class="Other">]</span>
  <span class="Identifier">mob_ptr</span><span class="Other">:</span> <span class="Identifier">uint</span>
  <span class="Identifier">refresh</span><span class="Other">:</span> <span class="Identifier">uint</span>
  <span class="Identifier">vcrc</span><span class="Other">:</span> <a href="vcrc.html#VcRc"><span class="Identifier">VcRc</span></a>
  <span class="Identifier">mcs</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="mc.html#Mc"><span class="Identifier">Mc</span></a><span class="Other">]</span>
</pre></dt>
<dd>



</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="new_memory_controller,RasterCounter,Pins,Registers"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#new_memory_controller%2CRasterCounter%2CPins%2CRegisters"><span class="Identifier">new_memory_controller</span></a><span class="Other">(</span><span class="Identifier">counter</span><span class="Other">:</span> <a href="raster.html#RasterCounter"><span class="Identifier">RasterCounter</span></a><span class="Other">;</span> <span class="Identifier">pins</span><span class="Other">:</span> <a href="../../components/pins.html#Pins"><span class="Identifier">Pins</span></a><span class="Other">;</span>
                           <span class="Identifier">registers</span><span class="Other">:</span> <a href="../../components/registers.html#Registers"><span class="Identifier">Registers</span></a><span class="Other">)</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>



</dd>
<a id="generate_address,MemoryController"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#generate_address%2CMemoryController"><span class="Identifier">generate_address</span></a><span class="Other">(</span><span class="Identifier">memory</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Other">(</span><a href="access.html#AccessType"><span class="Identifier">AccessType</span></a><span class="Other">,</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Generates the next read address. Which is used depends on the current state of the raster counter (the current raster line and clock phase and cycle).

</dd>
<a id="pre_read,MemoryController"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#pre_read%2CMemoryController"><span class="Identifier">pre_read</span></a><span class="Other">(</span><span class="Identifier">memory</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">KeyError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">,</span> <span class="Identifier">Exception</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Performs functions that need to happen before a memory read. This is largely updating the internal graphics registers, though it also includes setting the levels of BA and AEC and ensuring that all address pins are set to output mode.

</dd>
<a id="low_to_pins,MemoryController,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#low_to_pins%2CMemoryController%2Cuint"><span class="Identifier">low_to_pins</span></a><span class="Other">(</span><span class="Identifier">memory</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a><span class="Other">;</span> <span class="Identifier">address</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">KeyError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the levels of the address pins to the next address to be read. This actually sets <em>all</em> address pins; it's called <tt class="docutils literal"><span class="pre">low_to_pins</span></tt> because the multiplexed pins take on the value of the low address bits.

</dd>
<a id="high_to_pins,MemoryController,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#high_to_pins%2CMemoryController%2Cuint"><span class="Identifier">high_to_pins</span></a><span class="Other">(</span><span class="Identifier">memory</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a><span class="Other">;</span> <span class="Identifier">address</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the levels of the multiplexed pins to the high address values. This does not change the levels of any unmultiplexed pins.

</dd>
<a id="read,MemoryController,AccessType"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#read%2CMemoryController%2CAccessType"><span class="Identifier">read</span></a><span class="Other">(</span><span class="Identifier">memory</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a><span class="Other">;</span> <span class="Identifier">access</span><span class="Other">:</span> <a href="access.html#AccessType"><span class="Identifier">AccessType</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">uint</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">KeyError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">,</span> <span class="Identifier">Exception</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Performs an actual memory read, which in the end is the entire point of this module. The number of bits in the read value depends on the type of access; this type is also used to determine which read values to remember for future reads. Cleanup is done after the read. This includes setting multiplexed address pins back to input mode, tri-stating other address pins, and updating some of the graphics and mob registers.

</dd>
<a id="clear_yexp,MemoryController,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#clear_yexp%2CMemoryController%2Cuint"><span class="Identifier">clear_yexp</span></a><span class="Other">(</span><span class="Identifier">memory</span><span class="Other">:</span> <a href="memory.html#MemoryController"><span class="Identifier">MemoryController</span></a><span class="Other">;</span> <span class="Identifier">cleared</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Responsible for setting the sprite Y-expansion latches corresponding to 1-bits in the argument. The VIC immediately sets these latches when the corresponding Y-expansion register bit is cleared; it does nothing when that bit is <em>set</em>. This is what makes sprite crunching possible.</p>
<p>This function just delegates to the sprite registers affected.</p>


</dd>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2021-08-09 08:35:33 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
