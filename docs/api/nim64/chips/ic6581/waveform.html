<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>nim64/chips/ic6581/waveform</title>
<link rel="stylesheet" type="text/css" href="../../../nimdoc.out.css">

<script type="text/javascript" src="../../../dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);

  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true;
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">nim64/chips/ic6581/waveform</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    <li>
      <a href="../../../theindex.html">Index</a>
    </li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#Waveform"
    title="Waveform = ref object
  acc: uint ## The current value of the phase accumulator used to determine the oscillator
            ## output.
  lfsr: uint ## The current value of the linear feedback shift register  used to produce
             ## pseudo-random noise. The LFSR is  constructed like this:
             ## ```
             ##       +---XOR------------------+
             ##       |    |                   |
             ## BIT:  2221111111111            |
             ##       21098765432109876543210&lt;-+
             ##         | |   |  | |   |  | |
             ## OUTPUT: 7 6   5  4 3   2  1 0
             ## ```
             ## The eight output bits are the values on any given read of bits 0, 2, 5, 9,
             ## 11, 14, 18, and 20 of the shift register. On shift, each bit value is moved
             ## one to the left, and then the values of bits 17 and 22 are exclusive-ored
             ## and used for the new value of bit 0 (unless the `TEST` bit of `VCREG` is
             ## high, or the `RES` pin is low, in which case bit 0 will always take the
             ## value of `1`).
             ## 
             ## A shift will occur each time the value of bit 19 of the accumulator
             ## transitions from `0` to `1`. Since that frequency is determined by the
             ## values of `FREHI` and `FRELO`, the &quot;pitch&quot; of the noise can be tuned just
             ## like the pitch of any of the other waveforms.
  prev_msb: bool ## Tracks the previous value of the most significant bit of the oscillator
                 ## to which this oscillator is synched. If sync is enabled, this oscillator
                 ## will be forcibly reset each time the synched oscillator&apos;s MSB changes.
  last_clock: bool ## Tracks the previous value of the 19th bit of the phase accumulator.
                   ## This bit is used as a clock by the LFSR. Each time this bit
                   ## transitions high, the LFSR shifts once.
  freq: uint ## The value of the SID&apos;s frequency registers. This is the number that is
             ## added to the accumulator on each clock cycle.
  pw: uint ## The value of the SID&apos;s pulse width registers. This is a 12-bit number that
           ## determines when a pulse waveform&apos;s value shifts from zero to max.
  test: bool ## The value of the `TEST` bit of the control register, as a boolean. If this
             ## is `true`, the accumulator value will always be `0`, `1`s will be shifted
             ## into the noise LFSR, and the pulse waveform output will be all `1`s.
  ring: bool ## The value of the `RING` bit of the control register, as a boolean. If this
             ## is `true`, the frequency of the synched oscillator will be used to
             ## ring-modulate this oscillator, as long as the triangle waveform is selected.
  sync: bool ## The value of the `SYNC` bit of the control register, as a boolean. If this
             ## is `true`, the accumulator will be reset to `0` each time the MSB of the
             ## synched oscillator&apos;s accumulator transitions from `0` to `1`.
  waveform: uint ## The top four bits of the control register, which determine the
                 ## waveform(s) produced. This is stored as a combined number (rather than
                 ## as a series of `bool`s) because it makes the output selection a bit
                 ## easier.
  resetting: bool ## Indicates whether the generator is in the process of resetting. This
                  ## corresponds to the time when the chip&apos;s `RES` pin is held low. The LFSR
                  ## acts differently during this time.
  sync_target: Option[Waveform] ## The generator to which this generator is synched. This is
                                ## predetermined on the 6581; generator 1 is synched to
                                ## generator 3, 2 to 1, and 3 to 2. This value will be set
                                ## by the Ic6581 code itself after all three generators are
                                ## created, so it should never be `none` during actual
                                ## operation.">Waveform</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">pwhi
      <li><a class="reference" href="#pwhi%2CWaveform%2Cuint"
    title="pwhi(wv: Waveform; value: uint)">pwhi,<wbr>Waveform,<wbr>uint</a></li>

  </ul>
  <ul class="simple nested-toc-section">output
      <li><a class="reference" href="#output%2CWaveform"
    title="output(wv: Waveform): uint">output,<wbr>Waveform</a></li>

  </ul>
  <ul class="simple nested-toc-section">vcreg
      <li><a class="reference" href="#vcreg%2CWaveform%2Cuint"
    title="vcreg(wv: Waveform; value: uint)">vcreg,<wbr>Waveform,<wbr>uint</a></li>

  </ul>
  <ul class="simple nested-toc-section">reset
      <li><a class="reference" href="#reset%2CWaveform%2Cbool"
    title="reset(wv: Waveform; value: bool = true)">reset,<wbr>Waveform,<wbr>bool</a></li>

  </ul>
  <ul class="simple nested-toc-section">pwlo
      <li><a class="reference" href="#pwlo%2CWaveform%2Cuint"
    title="pwlo(wv: Waveform; value: uint)">pwlo,<wbr>Waveform,<wbr>uint</a></li>

  </ul>
  <ul class="simple nested-toc-section">new_waveform
      <li><a class="reference" href="#new_waveform"
    title="new_waveform(): Waveform">new_waveform</a></li>

  </ul>
  <ul class="simple nested-toc-section">frelo
      <li><a class="reference" href="#frelo%2CWaveform%2Cuint"
    title="frelo(wv: Waveform; value: uint)">frelo,<wbr>Waveform,<wbr>uint</a></li>

  </ul>
  <ul class="simple nested-toc-section">clock
      <li><a class="reference" href="#clock%2CWaveform"
    title="clock(wv: Waveform)">clock,<wbr>Waveform</a></li>

  </ul>
  <ul class="simple nested-toc-section">sync
      <li><a class="reference" href="#sync%2CWaveform%2CWaveform"
    title="sync(wv: Waveform; target: Waveform)">sync,<wbr>Waveform,<wbr>Waveform</a></li>

  </ul>
  <ul class="simple nested-toc-section">frehi
      <li><a class="reference" href="#frehi%2CWaveform%2Cuint"
    title="frehi(wv: Waveform; value: uint)">frehi,<wbr>Waveform,<wbr>uint</a></li>

  </ul>

  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"></p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../../utils.html">../../utils</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="Waveform"></a>
<dt><pre><a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a> <span class="Other">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>
  <span class="Identifier">acc</span><span class="Other">:</span> <span class="Identifier">uint</span> <span class="Comment">## The current value of the phase accumulator used to determine the oscillator</span>
            <span class="Comment">## output.</span>
  <span class="Identifier">lfsr</span><span class="Other">:</span> <span class="Identifier">uint</span> <span class="Comment">## The current value of the linear feedback shift register  used to produce</span>
             <span class="Comment">## pseudo-random noise. The LFSR is  constructed like this:</span>
             <span class="Comment">## ```</span>
             <span class="Comment">##       +---XOR------------------+</span>
             <span class="Comment">##       |    |                   |</span>
             <span class="Comment">## BIT:  2221111111111            |</span>
             <span class="Comment">##       21098765432109876543210&lt;-+</span>
             <span class="Comment">##         | |   |  | |   |  | |</span>
             <span class="Comment">## OUTPUT: 7 6   5  4 3   2  1 0</span>
             <span class="Comment">## ```</span>
             <span class="Comment">## The eight output bits are the values on any given read of bits 0, 2, 5, 9,</span>
             <span class="Comment">## 11, 14, 18, and 20 of the shift register. On shift, each bit value is moved</span>
             <span class="Comment">## one to the left, and then the values of bits 17 and 22 are exclusive-ored</span>
             <span class="Comment">## and used for the new value of bit 0 (unless the `TEST` bit of `VCREG` is</span>
             <span class="Comment">## high, or the `RES` pin is low, in which case bit 0 will always take the</span>
             <span class="Comment">## value of `1`).</span>
             <span class="Comment">## </span>
             <span class="Comment">## A shift will occur each time the value of bit 19 of the accumulator</span>
             <span class="Comment">## transitions from `0` to `1`. Since that frequency is determined by the</span>
             <span class="Comment">## values of `FREHI` and `FRELO`, the &quot;pitch&quot; of the noise can be tuned just</span>
             <span class="Comment">## like the pitch of any of the other waveforms.</span>
  <span class="Identifier">prev_msb</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Comment">## Tracks the previous value of the most significant bit of the oscillator</span>
                 <span class="Comment">## to which this oscillator is synched. If sync is enabled, this oscillator</span>
                 <span class="Comment">## will be forcibly reset each time the synched oscillator's MSB changes.</span>
  <span class="Identifier">last_clock</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Comment">## Tracks the previous value of the 19th bit of the phase accumulator.</span>
                   <span class="Comment">## This bit is used as a clock by the LFSR. Each time this bit</span>
                   <span class="Comment">## transitions high, the LFSR shifts once.</span>
  <span class="Identifier">freq</span><span class="Other">:</span> <span class="Identifier">uint</span> <span class="Comment">## The value of the SID's frequency registers. This is the number that is</span>
             <span class="Comment">## added to the accumulator on each clock cycle.</span>
  <span class="Identifier">pw</span><span class="Other">:</span> <span class="Identifier">uint</span> <span class="Comment">## The value of the SID's pulse width registers. This is a 12-bit number that</span>
           <span class="Comment">## determines when a pulse waveform's value shifts from zero to max.</span>
  <span class="Identifier">test</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Comment">## The value of the `TEST` bit of the control register, as a boolean. If this</span>
             <span class="Comment">## is `true`, the accumulator value will always be `0`, `1`s will be shifted</span>
             <span class="Comment">## into the noise LFSR, and the pulse waveform output will be all `1`s.</span>
  <span class="Identifier">ring</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Comment">## The value of the `RING` bit of the control register, as a boolean. If this</span>
             <span class="Comment">## is `true`, the frequency of the synched oscillator will be used to</span>
             <span class="Comment">## ring-modulate this oscillator, as long as the triangle waveform is selected.</span>
  <span class="Identifier">sync</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Comment">## The value of the `SYNC` bit of the control register, as a boolean. If this</span>
             <span class="Comment">## is `true`, the accumulator will be reset to `0` each time the MSB of the</span>
             <span class="Comment">## synched oscillator's accumulator transitions from `0` to `1`.</span>
  <span class="Identifier">waveform</span><span class="Other">:</span> <span class="Identifier">uint</span> <span class="Comment">## The top four bits of the control register, which determine the</span>
                 <span class="Comment">## waveform(s) produced. This is stored as a combined number (rather than</span>
                 <span class="Comment">## as a series of `bool`s) because it makes the output selection a bit</span>
                 <span class="Comment">## easier.</span>
  <span class="Identifier">resetting</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Comment">## Indicates whether the generator is in the process of resetting. This</span>
                  <span class="Comment">## corresponds to the time when the chip's `RES` pin is held low. The LFSR</span>
                  <span class="Comment">## acts differently during this time.</span>
  <span class="Identifier">sync_target</span><span class="Other">:</span> <span class="Identifier">Option</span><span class="Other">[</span><a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">]</span> <span class="Comment">## The generator to which this generator is synched. This is</span>
                                <span class="Comment">## predetermined on the 6581; generator 1 is synched to</span>
                                <span class="Comment">## generator 3, 2 to 1, and 3 to 2. This value will be set</span>
                                <span class="Comment">## by the Ic6581 code itself after all three generators are</span>
                                <span class="Comment">## created, so it should never be `none` during actual</span>
                                <span class="Comment">## operation.</span>
  </pre></dt>
<dd>

<p>A single tone oscillator/waveform generator used in the 6581 SID.</p>
<p>The oscillator consists of a phase accumulator followed by logic to turn the output of that oscillator into a waveform of a particular shape.</p>
<p>A phase accumulator is simply a 23-bit value to which a certain number is added on every clock cycle (each time the <tt class="docutils literal"><span class="pre">PHI2</span></tt> pin transitions high). The accumulator is allowed to overflow and lose the most significant bit, which has the result of &quot;resetting&quot; it to near zero on a regular basis. This produces a sawtooth-shaped waveform.</p>
<p>The number that is added to the PAO on each clock cycle is the value in the <tt class="docutils literal"><span class="pre">FREHI</span></tt> and <tt class="docutils literal"><span class="pre">FRELO</span></tt> registers. A higher number will cause the oscillator to overflow more frequently, producing a waveform of a higher frequency.</p>
<p>This is known as a &quot;phase accumulator&quot; because the normal <em>next</em> step in waveform generation is to consult a lookup table with the values of sines for the accumulator value. Thus, the PA is actually determining the phase of the sine wave so produced. The 6581 does not produce sine waves because there was not enough room on the chip to add such a sine lookup table (the PA waveform itself is output as a sawtooth wave), but it is still referred to as a phase accumulator.</p>
<p>The PA result is then fed into four waveform generators, one each for triangle, sawtooth, pulse, and noise waveforms. Which if these is enabled is controlled by the <tt class="docutils literal"><span class="pre">VCREG</span></tt> register. Multiple waveform generators can be enabled at once; when this is done, the output value at each clock cycle is the values of all enabled waveform generators, logically ANDed together.</p>


</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="frelo,Waveform,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#frelo%2CWaveform%2Cuint"><span class="Identifier">frelo</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the low 8 bits of the frequency.

</dd>
<a id="frehi,Waveform,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#frehi%2CWaveform%2Cuint"><span class="Identifier">frehi</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the high 8 bits of the frequency.

</dd>
<a id="pwlo,Waveform,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#pwlo%2CWaveform%2Cuint"><span class="Identifier">pwlo</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the low 8 bits of the pulse width.

</dd>
<a id="pwhi,Waveform,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#pwhi%2CWaveform%2Cuint"><span class="Identifier">pwhi</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the high 4 bits of the pulse width.

</dd>
<a id="vcreg,Waveform,uint"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#vcreg%2CWaveform%2Cuint"><span class="Identifier">vcreg</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">uint</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Sets the values of the test, ring, and sync bits, along with the waveform.

</dd>
<a id="reset,Waveform,bool"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#reset%2CWaveform%2Cbool"><span class="Identifier">reset</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">bool</span> <span class="Other">=</span> <span class="Identifier">true</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Resets the generator. What happens depends on the <tt class="docutils literal"><span class="pre">value</span></tt> argument; if it's false, this indicates that the <tt class="docutils literal"><span class="pre">RES</span></tt> pin has gone low, which changes the behavior of some parts of the waveform generator but does not fully reset it. If it's true, then the special behavior stops and the chip resets to its default values.

</dd>
<a id="clock,Waveform"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#clock%2CWaveform"><span class="Identifier">clock</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Advances the waveform generator one clock cycle. This advances the internal accumulator one generation and potentially shifts the LFSR once.

</dd>
<a id="sync,Waveform,Waveform"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#sync%2CWaveform%2CWaveform"><span class="Identifier">sync</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">;</span> <span class="Identifier">target</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Registers a waveform generator as the one to which this one is synched. This can't be done during construction because the generators sync recursively.

</dd>
<a id="output,Waveform"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#output%2CWaveform"><span class="Identifier">output</span></a><span class="Other">(</span><span class="Identifier">wv</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">uint</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Generates the output of the waveform generator.</p>
<p>A lot of documentation says that if more than one waveform is selected, the output is the bitwise AND of the selected waveforms. This real picture is much more complex; zero bits, for example, can bleed into adjacent one bits and flip them to zero. The mechanism by which this happens is not currently known.</p>
<p>This isn't modeled directly as the details aren't known. Instead, for combined waveforms, samples of actual data from the <tt class="docutils literal"><span class="pre">ENV3</span></tt> register of a physical 6581 are used. These are 4096-entry tables, one for each of the possible output values from the single waveform generators. The result is an 8-bit number that is shifted into a 12-bit number, so the bottom four bits are lost and therefore this is not an exact reproduction. But it's all you can get from the <tt class="docutils literal"><span class="pre">ENV3</span></tt> register.</p>
<p>Noise is handled differently. When noise is combined with any other waveform, the result (after a short time) is always values of 0. It is conjectured that this is because combining noise with another waveform causes the shift register to fill with zeros, meaning the noise waveform itself will be all zeroes. In the real 6581, this actually necessitates a chip reset in order for the shift register to be able to have any non-zero values from then on.</p>
<p>There is no model known for this behavior, so this method just returns <tt class="docutils literal"><span class="pre">0.</span></tt> The original 6581 documentation warned against combining noise with any other waveform, and that warning is repeated here.</p>


</dd>
<a id="new_waveform"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#new_waveform"><span class="Identifier">new_waveform</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <a href="waveform.html#Waveform"><span class="Identifier">Waveform</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Creates a new waveform generator with all internal values set to what they would be after a reset.

</dd>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2021-08-08 11:46:13 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
